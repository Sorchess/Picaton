/**
 * Граф ассоциаций тегов.
 * Каждый тег связан с похожими по смыслу словами.
 * Пользователь может строить цепочку, выбирая связанные теги.
 */

/**
 * Карта ассоциаций: тег → связанные теги.
 */
const TAG_ASSOCIATIONS: Record<string, string[]> = {
  // === IT и разработка ===
  python: [
    "backend",
    "django",
    "fastapi",
    "data science",
    "machine learning",
    "автоматизация",
  ],
  питон: ["python", "backend", "django", "fastapi", "data science"],
  javascript: ["frontend", "react", "vue", "node.js", "typescript", "web"],
  typescript: ["javascript", "frontend", "react", "angular", "node.js"],
  java: ["backend", "spring", "android", "enterprise"],
  kotlin: ["android", "mobile", "java"],
  swift: ["ios", "mobile", "apple"],
  "c++": ["системное программирование", "gamedev", "unreal"],
  "c#": [".net", "unity", "gamedev", "backend"],
  go: ["backend", "микросервисы", "devops"],
  rust: ["системное программирование", "backend", "performance"],
  php: ["backend", "web", "wordpress"],

  react: ["frontend", "javascript", "typescript", "next.js", "redux"],
  vue: ["frontend", "javascript", "nuxt", "web"],
  angular: ["frontend", "typescript", "enterprise"],
  "next.js": ["react", "fullstack", "ssr", "vercel"],
  node: ["backend", "javascript", "express", "api"],
  "node.js": ["backend", "javascript", "express", "api"],

  frontend: ["react", "vue", "javascript", "css", "html", "верстка", "ui"],
  фронтенд: ["frontend", "react", "vue", "верстка", "javascript"],
  фронтендер: ["frontend", "react", "vue", "javascript", "верстка"],
  backend: ["api", "python", "java", "node.js", "базы данных", "микросервисы"],
  бэкенд: ["backend", "api", "python", "сервер", "микросервисы"],
  бэкендер: ["backend", "api", "python", "сервер", "микросервисы"],
  бекенд: ["backend", "api", "python", "сервер", "микросервисы"],
  бекендер: ["backend", "api", "python", "сервер", "микросервисы"],
  fullstack: ["frontend", "backend", "web", "разработка"],
  фулстек: ["fullstack", "frontend", "backend"],
  разработка: ["программирование", "код", "it", "software", "проекты"],
  разработчик: ["программист", "backend", "frontend", "код", "it"],
  программист: ["разработчик", "код", "it", "software", "программирование"],
  программирование: ["разработка", "код", "it", "software"],
  web: ["frontend", "backend", "html", "css", "javascript", "сайты"],
  mobile: ["ios", "android", "flutter", "react native", "приложения"],

  html: ["css", "верстка", "frontend", "web"],
  css: ["html", "верстка", "sass", "tailwind", "стили"],
  верстка: ["html", "css", "frontend", "макеты", "адаптив"],

  devops: ["docker", "kubernetes", "ci/cd", "linux", "cloud", "автоматизация"],
  docker: ["devops", "kubernetes", "контейнеры", "деплой"],
  kubernetes: ["docker", "devops", "cloud", "оркестрация"],
  linux: ["devops", "сервера", "администрирование", "bash"],
  aws: ["cloud", "devops", "инфраструктура"],
  cloud: ["aws", "azure", "gcp", "devops", "сервера"],

  "data science": [
    "python",
    "machine learning",
    "аналитика",
    "pandas",
    "статистика",
  ],
  "machine learning": [
    "python",
    "data science",
    "нейросети",
    "ai",
    "tensorflow",
  ],
  ai: ["machine learning", "нейросети", "chatgpt", "автоматизация"],
  нейросети: ["machine learning", "deep learning", "python", "ai"],

  api: ["backend", "rest", "graphql", "интеграции"],
  микросервисы: ["backend", "docker", "api", "архитектура"],
  "базы данных": ["sql", "postgresql", "mongodb", "backend"],
  sql: ["базы данных", "postgresql", "mysql", "аналитика"],

  // === Дизайн ===
  дизайн: ["ui", "ux", "figma", "графика", "креатив", "визуал"],
  ui: ["ux", "дизайн", "figma", "интерфейсы", "frontend"],
  ux: ["ui", "дизайн", "исследования", "прототипы", "юзабилити"],
  figma: ["ui", "ux", "дизайн", "прототипы", "макеты"],
  "графический дизайн": [
    "дизайн",
    "illustrator",
    "photoshop",
    "брендинг",
    "полиграфия",
  ],
  графика: ["дизайн", "illustrator", "визуал"],
  illustrator: ["графический дизайн", "вектор", "логотипы"],
  photoshop: ["графический дизайн", "ретушь", "фото", "обработка"],
  брендинг: ["дизайн", "логотипы", "айдентика", "маркетинг", "стиль"],
  логотипы: ["брендинг", "дизайн", "графический дизайн", "айдентика"],

  // === Маркетинг ===
  маркетинг: ["smm", "seo", "реклама", "контент", "продвижение", "бренд"],
  smm: ["маркетинг", "соцсети", "контент", "таргет", "instagram", "telegram"],
  seo: ["маркетинг", "продвижение", "сайты", "аналитика", "трафик"],
  таргет: ["реклама", "smm", "маркетинг", "аналитика", "аудитория"],
  реклама: ["маркетинг", "таргет", "продвижение", "креатив", "бюджет"],
  контент: ["smm", "копирайтинг", "блог", "маркетинг", "тексты"],
  копирайтинг: ["контент", "тексты", "блог", "smm", "статьи"],
  тексты: ["копирайтинг", "контент", "редактура", "статьи"],
  pr: ["маркетинг", "коммуникации", "сми", "репутация", "пресса"],

  // === Менеджмент ===
  "product manager": ["продукт", "agile", "аналитика", "стратегия", "roadmap"],
  продакт: ["product manager", "продукт", "agile"],
  "project manager": ["управление проектами", "agile", "команда", "сроки"],
  проджект: ["project manager", "управление проектами"],
  продукт: ["product manager", "стратегия", "развитие", "аналитика", "mvp"],
  agile: ["scrum", "kanban", "управление", "команда", "спринты"],
  scrum: ["agile", "спринты", "команда", "ретро"],
  kanban: ["agile", "доска", "процессы"],
  "team lead": [
    "управление",
    "команда",
    "менторство",
    "разработка",
    "код-ревью",
  ],
  тимлид: ["team lead", "управление", "команда"],
  менторство: ["обучение", "team lead", "развитие", "наставничество"],

  // === Кулинария ===
  повар: ["кухня", "кулинария", "ресторан", "еда", "рецепты", "готовка"],
  кондитер: ["выпечка", "торты", "десерты", "сладкое", "кремы"],
  пекарь: ["выпечка", "хлеб", "тесто", "булочки"],
  шеф: ["повар", "ресторан", "кухня", "меню", "авторская кухня"],
  кулинария: ["повар", "еда", "рецепты", "готовка", "блюда"],
  еда: ["кулинария", "рецепты", "повар", "питание"],
  выпечка: ["кондитер", "пекарь", "торты", "хлеб", "тесто"],
  торты: ["кондитер", "выпечка", "десерты", "праздники", "украшение"],
  десерты: ["кондитер", "сладкое", "торты", "выпечка"],
  ресторан: ["повар", "шеф", "кафе", "общепит", "horeca", "меню"],
  кафе: ["ресторан", "общепит", "бариста", "кофе", "уют"],
  бариста: ["кофе", "кафе", "напитки", "латте-арт"],
  кофе: ["бариста", "кафе", "напитки", "обжарка"],
  бармен: ["напитки", "коктейли", "бар", "миксология"],

  // === Здоровье и красота ===
  врач: ["медицина", "здоровье", "лечение", "пациенты", "диагностика"],
  доктор: ["врач", "медицина", "здоровье"],
  медицина: ["врач", "здоровье", "лечение", "клиника", "терапия"],
  здоровье: ["медицина", "фитнес", "питание", "wellness", "зож"],
  психолог: ["психология", "терапия", "консультации", "ментальное здоровье"],
  психология: ["психолог", "терапия", "коучинг", "эмоции"],
  терапия: ["психолог", "психология", "лечение", "восстановление"],
  коучинг: ["психология", "развитие", "менторство", "мотивация", "цели"],

  фитнес: ["спорт", "тренер", "здоровье", "тренировки", "зал"],
  тренер: ["фитнес", "спорт", "тренировки", "здоровье", "программы"],
  спорт: ["фитнес", "тренер", "здоровье", "соревнования", "атлетика"],
  тренировки: ["фитнес", "тренер", "спорт", "программы"],
  йога: ["фитнес", "медитация", "здоровье", "растяжка", "практика"],
  массаж: ["спа", "здоровье", "релакс", "тело", "расслабление"],
  спа: ["массаж", "релакс", "уход", "процедуры"],

  косметолог: ["красота", "уход", "кожа", "процедуры", "лицо"],
  красота: ["косметолог", "визажист", "стилист", "уход", "салон"],
  визажист: ["макияж", "красота", "стилист", "образ", "бьюти"],
  макияж: ["визажист", "красота", "образ", "косметика"],
  стилист: ["мода", "красота", "образ", "гардероб", "шопинг"],
  мода: ["стилист", "одежда", "тренды", "образ"],
  парикмахер: ["волосы", "стрижка", "красота", "укладка", "окрашивание"],
  волосы: ["парикмахер", "стрижка", "укладка", "окрашивание"],
  стрижка: ["парикмахер", "барбер", "волосы"],
  барбер: ["стрижка", "борода", "мужской стиль", "парикмахер"],
  маникюр: ["ногти", "красота", "уход", "педикюр"],

  // === Образование ===
  учитель: ["образование", "школа", "обучение", "дети", "уроки"],
  репетитор: ["обучение", "подготовка", "экзамены", "предметы", "егэ"],
  преподаватель: ["образование", "университет", "лекции", "курсы"],
  образование: ["обучение", "курсы", "школа", "развитие", "знания"],
  обучение: ["курсы", "образование", "тренинги", "развитие", "навыки"],
  курсы: ["обучение", "онлайн", "навыки", "сертификаты"],
  школа: ["учитель", "образование", "дети", "уроки"],

  // === Дети ===
  дети: ["воспитание", "развитие", "семья", "школа"],
  воспитание: ["дети", "семья", "педагогика"],
  няня: ["дети", "уход", "семья"],
  аниматор: ["дети", "праздники", "развлечения"],

  // === Творчество ===
  фотограф: ["фото", "съёмка", "портрет", "события", "свадьба"],
  фото: ["фотограф", "съёмка", "обработка", "lightroom", "портрет"],
  съёмка: ["фото", "видео", "фотограф", "видеограф"],
  видеограф: ["видео", "съёмка", "монтаж", "контент", "клипы"],
  видео: ["видеограф", "монтаж", "youtube", "контент", "ролики"],
  монтаж: ["видео", "premiere", "after effects", "постпродакшн"],

  художник: ["рисование", "искусство", "иллюстрации", "живопись"],
  иллюстратор: ["рисование", "дизайн", "графика", "персонажи"],
  рисование: ["художник", "иллюстратор", "скетчи", "арт"],
  искусство: ["художник", "творчество", "галерея"],

  музыкант: ["музыка", "инструменты", "концерты", "группа"],
  музыка: ["музыкант", "звук", "продакшн", "диджей", "песни"],
  диджей: ["музыка", "мероприятия", "миксы", "клубы"],
  звук: ["музыка", "продакшн", "микширование"],

  писатель: ["тексты", "книги", "сторителлинг", "автор"],
  автор: ["писатель", "книги", "тексты", "контент"],
  блогер: ["контент", "smm", "youtube", "соцсети", "инфлюенсер"],
  ведущий: ["мероприятия", "праздники", "шоу", "события"],
  праздники: ["ведущий", "события", "организация", "торты"],
  события: ["мероприятия", "организация", "ивенты"],
  мероприятия: ["события", "ведущий", "организация", "ивенты"],

  // === Строительство и ремонт ===
  строительство: ["ремонт", "стройка", "объекты", "проекты"],
  стройка: ["строительство", "ремонт", "бригада"],
  ремонт: ["строительство", "отделка", "квартиры", "дом"],
  отделка: ["ремонт", "интерьер", "материалы"],
  электрик: ["электрика", "монтаж", "проводка", "щитки"],
  сантехник: ["сантехника", "трубы", "ремонт", "водоснабжение"],
  плотник: ["дерево", "мебель", "столярка", "изделия"],
  мебель: ["плотник", "дерево", "интерьер", "дизайн"],
  сварщик: ["металл", "сварка", "конструкции"],

  // === Авто ===
  автомеханик: ["авто", "ремонт", "техника", "диагностика"],
  авто: ["автомеханик", "машины", "сервис"],
  водитель: ["транспорт", "логистика", "доставка", "перевозки"],
  такси: ["водитель", "перевозки", "город"],

  // === Бизнес и финансы ===
  юрист: ["право", "консультации", "договоры", "суд"],
  право: ["юрист", "законы", "консультации"],
  бухгалтер: ["финансы", "учёт", "налоги", "1с", "отчётность"],
  финансы: ["бухгалтер", "инвестиции", "аналитика", "деньги"],
  инвестиции: ["финансы", "трейдинг", "портфель", "акции"],
  аналитика: ["данные", "отчёты", "метрики", "bi", "excel"],
  hr: ["рекрутинг", "кадры", "найм", "персонал", "собеседования"],
  рекрутинг: ["hr", "найм", "собеседования", "поиск"],
  найм: ["hr", "рекрутинг", "персонал"],
  продажи: ["менеджер", "клиенты", "переговоры", "b2b", "сделки"],
  менеджер: ["продажи", "клиенты", "управление", "crm"],
  клиенты: ["продажи", "сервис", "поддержка"],

  // === Логистика ===
  логистика: ["склад", "доставка", "транспорт", "грузы"],
  доставка: ["логистика", "курьер", "транспорт"],
  курьер: ["доставка", "логистика", "город"],
  склад: ["логистика", "хранение", "учёт"],

  // === Языки ===
  переводчик: ["языки", "перевод", "локализация", "тексты"],
  перевод: ["переводчик", "языки", "локализация"],
  английский: ["языки", "перевод", "обучение", "разговорный"],
  языки: ["переводчик", "обучение", "международный", "английский"],

  // === Домены и ниши ===
  стартап: ["бизнес", "инвестиции", "продукт", "mvp", "предприниматель"],
  бизнес: ["стартап", "предприниматель", "компания", "развитие"],
  предприниматель: ["бизнес", "стартап", "своё дело"],
  ecommerce: ["интернет-магазин", "продажи", "онлайн", "маркетплейс"],
  "интернет-магазин": ["ecommerce", "продажи", "товары"],
  fintech: ["финансы", "технологии", "банки", "платежи", "стартап"],
  edtech: ["образование", "технологии", "курсы", "онлайн"],
  gamedev: ["игры", "unity", "unreal", "разработка", "геймдизайн"],
  игры: ["gamedev", "unity", "геймдизайн", "развлечения"],
  blockchain: ["crypto", "web3", "смарт-контракты", "defi"],
  crypto: ["blockchain", "трейдинг", "инвестиции", "nft"],
  web3: ["blockchain", "crypto", "децентрализация"],
};

/**
 * Извлечь теги из текста bio на основе ассоциаций.
 * Находит ключевые слова в тексте и возвращает связанные теги.
 */
export function extractTagsFromBio(
  bio: string,
  maxTags: number = 12
): string[] {
  if (!bio || bio.trim().length < 3) {
    return [];
  }

  const bioLower = bio.toLowerCase();
  const foundTags = new Set<string>();
  const matchedKeywords: string[] = [];

  // Ищем все ключевые слова из ассоциаций в тексте (только целые слова)
  for (const keyword of Object.keys(TAG_ASSOCIATIONS)) {
    // Используем границы слов для точного совпадения
    // Экранируем спецсимволы в ключевом слове (для c++, c#, node.js и т.д.)
    const escaped = keyword.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    const wordBoundaryRegex = new RegExp(
      `(?:^|[\\s,;:.!?()\\-])${escaped}(?:[\\s,;:.!?()\\-]|$)`,
      "i"
    );

    if (wordBoundaryRegex.test(bioLower)) {
      matchedKeywords.push(keyword);
      foundTags.add(keyword);
    }
  }

  // Добавляем связанные теги для найденных ключевых слов
  for (const keyword of matchedKeywords) {
    const associations = TAG_ASSOCIATIONS[keyword] || [];
    for (const tag of associations) {
      foundTags.add(tag);
    }
  }

  // Формируем результат: сначала найденные ключевые слова, потом связанные
  const result = [...matchedKeywords];
  for (const tag of foundTags) {
    if (!matchedKeywords.includes(tag)) {
      result.push(tag);
    }
  }

  return result.slice(0, maxTags);
}

/**
 * Получить связанные теги для выбранного тега.
 * Используется для построения цепочки тегов.
 */
export function getRelatedTags(tag: string): string[] {
  const normalizedTag = tag.toLowerCase();
  return TAG_ASSOCIATIONS[normalizedTag] || [];
}

/**
 * Получить все доступные теги для автокомплита.
 */
export function getAllTags(): string[] {
  return Object.keys(TAG_ASSOCIATIONS);
}
